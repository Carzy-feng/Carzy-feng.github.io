<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>恶意代码分析-day1</title>
    <link href="/2022/04/19/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90-day1/"/>
    <url>/2022/04/19/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90-day1/</url>
    
    <content type="html"><![CDATA[<h1 id="恶意代码分析"><a href="#恶意代码分析" class="headerlink" title="恶意代码分析"></a>恶意代码分析</h1><p><a href="https://codeload.github.com/Hadreysl/-/zip/refs/heads/master">下载连接</a></p><h2 id="Lab-1-1"><a href="#Lab-1-1" class="headerlink" title="Lab 1-1"></a>Lab 1-1</h2><p>分析Lab01-01.exe和Lab01-01.dll</p><h3 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h3><p>1、将代码上传至http[:]&#x2F;&#x2F;www[.]VirusTotal[.com]&#x2F;进行分析并查看报告。文件匹配到了已有的反病毒软件特征吗</p><p>2、这些文件是什么时候编译的</p><p>3、这两个文件中是否存在迹象说明它们是否被加壳或混淆了？如果是，这些迹象在哪里</p><p>4、是否有导入函数显示出了这个恶意代码是做说明的？如果是，是哪些导入函数？</p><p>5、是否有导入函数显示或基于主机的迹象，让你可以在受感染系统上查找？</p><p>6、是否有基于网络的迹象，可以用来发现受感染机器上的这个恶意代码？</p><p>7、你猜这些文件的目的是什么</p><h3 id="答案"><a href="#答案" class="headerlink" title="答案"></a>答案</h3><p>1、</p><p>lab01-01.exe</p><p><img src="https://cdn.jsdelivr.net/gh/Carzy-feng/images@main/data/202204191343955.png" alt="image-20220419134310648"></p><p><img src="https://cdn.jsdelivr.net/gh/Carzy-feng/images@main/data/202204191345676.png" alt="image-20220419134536322"></p><p>lab01-01.dll</p><p><img src="https://cdn.jsdelivr.net/gh/Carzy-feng/images@main/data/202204191347625.png" alt="image-20220419134726304"></p><p>2、编译时间：2010-12-20 0：16：19</p><p><img src="https://cdn.jsdelivr.net/gh/Carzy-feng/images@main/data/202204191349022.png" alt="image-20220419134951503"></p><p>3、加壳情况：否。每个节的虚拟大小和实际大小都差不多</p><p><img src="https://cdn.jsdelivr.net/gh/Carzy-feng/images@main/data/202204191351037.png" alt="image-20220419135148037"></p><p>4、释放一个文件</p><p><strong>EXE</strong></p><p><img src="https://cdn.jsdelivr.net/gh/Carzy-feng/images@main/data/202204191357974.png" alt="image-20220419135744882"></p><p>通过<code>createFile</code>创建一个新文件，并用<code>FindNextFile/FindFirstFile</code>查找该文件,还使用了<code>CopyfileA</code>复制文件，使用该病毒会查找和释放文件、以及复制文件</p><p>然后用<code>CreateFileMapping</code>加载该文件，使用<code>MapViewOfFile</code>将来读取和修改该文件，该函数可以修改PE文件，</p><p><strong>DLL</strong></p><p><img src="https://cdn.jsdelivr.net/gh/Carzy-feng/images@main/data/202204191414606.png" alt="image-20220419141409485"></p><p>存在<code>Sleep</code>延时执行，以及<code>CreateProcess</code>创建并启动一个新进程，即会执行文件，结合前面的exe分析可得知，该木马会释放一个pe文件，并执行，</p><p>该DLL导如了<code>WS2_32.dll</code>即存在联网行为</p><p>5、exe中存在路径<code>c:\\windows\\system32\\kerne132.dll</code></p><p><img src="https://cdn.jsdelivr.net/gh/Carzy-feng/images@main/data/202204191431960.png" alt="image-20220419143100626"></p><p>跟进去发现是创建一个文件，至此，可以得知，该木马会<code>c:\\windows\\system32\\kerne132.dll</code>，只需要查找该文件即可定位</p><p><img src="https://cdn.jsdelivr.net/gh/Carzy-feng/images@main/data/202204191430505.png" alt="image-20220419143036570"></p><p>6、DLL中存在127[.]26[.]152[.]13这个IP，只要在受感染的机器上查看是否有访问这个IP即可找到该恶意代码</p><p>7、</p><h2 id="Lab-1-2"><a href="#Lab-1-2" class="headerlink" title="Lab 1-2"></a>Lab 1-2</h2><p>分析Lab01-02.exe</p><h3 id="问题-1"><a href="#问题-1" class="headerlink" title="问题"></a>问题</h3><p>1、将代码上传至http[:]&#x2F;&#x2F;www[.]VirusTotal[.com]&#x2F;进行分析并查看报告。文件匹配到了已有的反病毒软件特征吗？</p><p>2、是否由这个文件被加壳或混淆的任何迹象？如果是这样，这些迹象是什么？如果该文件被加壳，请进行脱壳，如果可能的话。</p><p>3、有没有任何导入函数能够暗示出这个程序的功能？如果是，是哪些导入函数，他们会告诉你什么？</p><p>4、哪些基于主机或基于网络的迹象可以被用来确定这个恶意代码所感染的机器？</p><h3 id="答案-1"><a href="#答案-1" class="headerlink" title="答案"></a>答案</h3><p>1、</p><p><img src="https://cdn.jsdelivr.net/gh/Carzy-feng/images@main/data/202204191437155.png" alt="image-20220419143732139"></p><p>2、存在加壳、UPX壳，虚拟大小和实际大小不符合</p><p><img src="https://cdn.jsdelivr.net/gh/Carzy-feng/images@main/data/202204191438115.png" alt="image-20220419143834632"></p><p>使用UPX脱壳 <code>upx.exe -d lab01-02.exe</code></p><p><img src="https://cdn.jsdelivr.net/gh/Carzy-feng/images@main/data/202204191517292.png" alt="image-20220419151721265"></p><p>3、导入了<code>Kernel32.dll、ADVAAPI32.DLL、WINNET.DLL</code></p><p><code>WINNET.DLL</code>中使用了<code>InternetOpenUrl</code>这说明使用了FTP、HTTP或HTTPS访问了特定url</p><p><img src="https://cdn.jsdelivr.net/gh/Carzy-feng/images@main/data/202204191555933.png" alt="image-20220419155508706"></p><p><code>Kernel32.dll</code>中使用了<code>GetModuleFileName</code>在运行进程时进行修改和复制文件，以及使用<code>CreateMutexA</code>和<code>OpenMutex</code>来创建一个互斥对象，以及打开互斥对象，使该主机只存在一个该对象。以及使用<code>CreateWaitableTimer</code>和<code>SetWaitableTimer</code>创建定时任务，</p><p><img src="https://cdn.jsdelivr.net/gh/Carzy-feng/images@main/data/202204191555981.png" alt="image-20220419155523809"></p><p><code>ADVAPI32.dll</code>中使用了<code>CreateServiceA</code>来创建一个在启动时刻运行的服务，常用于持久化、隐藏或启动内核驱动</p><p><img src="https://cdn.jsdelivr.net/gh/Carzy-feng/images@main/data/202204191555911.png" alt="image-20220419155537446"></p><p>4、查找字符串时可以得知，该exe会访问<code>http[:]//www[.]malwareanalysisbook[.]com</code></p><p><img src="https://cdn.jsdelivr.net/gh/Carzy-feng/images@main/data/202204191600971.png" alt="image-20220419160053840"></p><p>跟进该字符串</p><p><img src="https://cdn.jsdelivr.net/gh/Carzy-feng/images@main/data/202204191601665.png" alt="image-20220419160126963"></p><p>继续跟进该变量</p><p><img src="https://cdn.jsdelivr.net/gh/Carzy-feng/images@main/data/202204191602079.png" alt="image-20220419160159556"></p><p>使用了<code>InternetOpen</code>初始化访问的URL，可以确认感染的机器会访问该URL，这是我们清除了访问的网络特征，但调用的<code>CreateServiceA</code>进行持久化特征还未发现，接下来回到声明字符串处继续查找</p><p>跟进<code>Malservice</code>,确定该字符串为创建服务名称</p><p><img src="https://cdn.jsdelivr.net/gh/Carzy-feng/images@main/data/202204191612478.png" alt="image-20220419161242300"></p><p>与他们一起声明的还有<code>HGL345</code>，确定了该字符串为运行时实例的名称</p><p><img src="https://cdn.jsdelivr.net/gh/Carzy-feng/images@main/data/202204191616700.png" alt="image-20220419161639520"></p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>Hello World</title>
    <link href="/2022/04/19/hello-world/"/>
    <url>/2022/04/19/hello-world/</url>
    
    <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p><h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><pre><code class="hljs bash">$ hexo new <span class="hljs-string">&quot;My New Post&quot;</span><br></code></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/writing.html">Writing</a></p><h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ hexo server<br></code></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/server.html">Server</a></p><h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ hexo generate<br></code></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/generating.html">Generating</a></p><h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ hexo deploy<br></code></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>]]></content>
    
    
    
  </entry>
  
  
  
  
</search>
